<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#0a6b5f; --brand2:#0c7a6d;
      --ink:#0f172a; --muted:#64748b;
      --bg:#f6f8fb; --card:#ffffff; --stroke:#e5e7eb;
      --ok:#16a34a; --warn:#f59e0b; --bad:#dc2626;
      --shadow: 0 10px 30px rgba(2,6,23,.08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:var(--bg)}
    .container{max-width:1200px;margin:0 auto;padding:18px}
    .topbar{background:#fff;border-bottom:1px solid var(--stroke);position:sticky;top:0;z-index:50}
    .topbar-inner{display:flex;align-items:center;gap:14px;justify-content:space-between;padding:14px 18px;max-width:1200px;margin:0 auto}
    .brand{display:flex;align-items:center;gap:12px;min-width:260px}
    .brand img{width:44px;height:44px;border-radius:12px;object-fit:cover;border:1px solid var(--stroke);background:#fff}
    .brand .t{display:flex;flex-direction:column;line-height:1.15}
    .brand .t strong{font-weight:800}
    .brand .t span{color:var(--muted);font-size:12.5px}
    .nav{display:flex;gap:10px;flex-wrap:wrap}
    .tab{border:1px solid var(--stroke);background:#fff;color:var(--ink);padding:10px 14px;border-radius:999px;cursor:pointer;font-weight:700;transition:.15s ease}
    .tab.active{background:rgba(10,107,95,.08);border-color:rgba(10,107,95,.25);color:var(--brand)}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:rgba(10,107,95,.08);border:1px solid rgba(10,107,95,.18);color:var(--brand);font-weight:800;font-size:13px;white-space:nowrap}
    .grid{display:grid;gap:14px}
    @media (min-width:980px){.grid.cols-2{grid-template-columns:1.1fr .9fr}.grid.cols-3{grid-template-columns:repeat(3,1fr)}.grid.cols-4{grid-template-columns:repeat(4,1fr)}}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .card h2,.card h3{margin:0 0 10px 0}
    .sub{color:var(--muted);font-size:13px;margin-top:-4px}
    .hero{border-radius:var(--radius);background:linear-gradient(135deg,rgba(10,107,95,.10),rgba(10,107,95,.04));border:1px solid rgba(10,107,95,.18);padding:16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .hero h1{margin:0;font-size:22px}
    .hero p{margin:6px 0 0 0;color:var(--muted);font-size:13.5px;max-width:700px}
    .btn{border:1px solid var(--stroke);background:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800;transition:.15s ease;display:inline-flex;align-items:center;justify-content:center;gap:8px}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .btn.primary:hover{filter:brightness(.98)}
    .btn.ghost:hover{background:#f2f4f8}
    .btn.danger{border-color:rgba(220,38,38,.3);color:var(--bad)}
    .btn.small{padding:7px 10px;border-radius:10px;font-size:13px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .spacer{height:14px}
    label{display:block;font-weight:800;margin:10px 0 6px}
    input,select,textarea{width:100%;border:1px solid var(--stroke);border-radius:12px;padding:11px 12px;font-family:inherit;font-size:14px;background:#fff;outline:none;transition:.15s ease}
    input:focus,select:focus,textarea:focus{border-color:rgba(10,107,95,.45);box-shadow:0 0 0 4px rgba(10,107,95,.10)}
    textarea{min-height:110px;resize:vertical}
    .hint{color:var(--muted);font-size:12.5px;margin-top:6px}
    .stat{display:flex;justify-content:space-between;align-items:flex-end;gap:10px;padding:14px;border-radius:14px;border:1px solid var(--stroke);background:linear-gradient(180deg,#fff,#fbfdff)}
    .stat .k{color:var(--muted);font-weight:800;font-size:13px}
    .stat .v{font-size:28px;font-weight:900;line-height:1}
    .stat .tag{font-size:12px;font-weight:900;padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);background:#fff;color:var(--muted)}
    .tag.ok{color:var(--ok);border-color:rgba(22,163,74,.25);background:rgba(22,163,74,.06)}
    .tag.warn{color:var(--warn);border-color:rgba(245,158,11,.25);background:rgba(245,158,11,.07)}
    .tag.bad{color:var(--bad);border-color:rgba(220,38,38,.25);background:rgba(220,38,38,.06)}
    .barlist{display:flex;flex-direction:column;gap:10px;margin-top:10px}
    .bar{display:grid;grid-template-columns:160px 1fr 48px;gap:10px;align-items:center}
    @media (max-width:720px){.bar{grid-template-columns:1fr}.bar .pct{justify-self:start}}
    .bar .name{font-weight:900}
    .track{height:10px;border-radius:999px;background:#eef2f7;border:1px solid var(--stroke);overflow:hidden}
    .fill{height:100%;width:0%;background:linear-gradient(90deg,var(--brand),var(--brand2));border-radius:999px}
    .pct{color:var(--muted);font-weight:900;font-size:12px;justify-self:end}
    .table-wrap{overflow:auto;border:1px solid var(--stroke);border-radius:14px}
    table{width:100%;border-collapse:separate;border-spacing:0;min-width:980px;background:#fff}
    th,td{padding:12px 10px;border-bottom:1px solid var(--stroke);vertical-align:top}
    th{position:sticky;top:0;background:#fbfcfe;text-align:right;font-size:13px;color:var(--muted)}
    tr:hover td{background:#fafcff}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12.5px}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);font-weight:900;font-size:12px;white-space:nowrap;background:#fff}
    .badge.new{color:var(--brand);border-color:rgba(10,107,95,.25);background:rgba(10,107,95,.06)}
    .badge.inprogress{color:#2563eb;border-color:rgba(37,99,235,.25);background:rgba(37,99,235,.06)}
    .badge.done{color:var(--ok);border-color:rgba(22,163,74,.25);background:rgba(22,163,74,.06)}
    .badge.late{color:var(--bad);border-color:rgba(220,38,38,.25);background:rgba(220,38,38,.06)}
    .muted{color:var(--muted)}
    .right{display:flex;gap:10px;align-items:center;justify-content:flex-end;flex-wrap:wrap}
    .divider{height:1px;background:var(--stroke);margin:12px 0}
    .toast{position:fixed;bottom:18px;left:18px;max-width:420px;padding:12px 14px;border-radius:14px;background:#0b1220;color:#fff;box-shadow:0 16px 40px rgba(0,0,0,.25);opacity:0;transform:translateY(10px);transition:.18s ease;z-index:1000}
    .toast.show{opacity:1;transform:translateY(0)}
    .footer{color:var(--muted);font-size:12.5px;padding:18px 0 26px;text-align:center}

    /* Login */
    .overlay{position:fixed;inset:0;background:rgba(2,6,23,.45);backdrop-filter: blur(6px);display:none;align-items:center;justify-content:center;z-index:999}
    .login-card{width:min(520px, 92vw)}
    .login-title{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .mini{font-size:12px;color:var(--muted);font-weight:800}
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <img alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù‡ÙŠØ¦Ø©" src="https://saudipedia.com/en/saudipediaen/uploads/images/2024/05/29/thumbs/600x600/90751.jpg">
        <div class="t">
          <strong>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</strong>
          <span>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† + Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</span>
        </div>
      </div>

      <nav class="nav">
        <button class="tab active" id="tab-employee" type="button">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button>
        <button class="tab" id="tab-admin" type="button">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
      </nav>

      <div class="row">
        <span class="pill" id="pill-now">Ø§Ù„ÙŠÙˆÙ…: â€”</span>
        <button class="btn small ghost" id="btn-login" type="button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <button class="btn small danger" id="btn-logout" type="button" style="display:none">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </div>
    </div>
  </header>

  <!-- Login Overlay -->
  <div class="overlay" id="loginOverlay" aria-hidden="true">
    <div class="card login-card">
      <div class="login-title">
        <div>
          <h2 style="margin:0 0 4px 0">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
          <div class="sub">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ± ÙˆØ³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©.</div>
        </div>
        <span class="pill" id="sessionPill">ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„</span>
      </div>

      <div class="divider"></div>

      <label>Ø§Ù„Ø¯ÙˆØ±</label>
      <select id="loginRole">
        <option value="EMPLOYEE">Ù…ÙˆØ¸Ù</option>
        <option value="ADMIN">Ù…Ø¯ÙŠØ±</option>
      </select>

      <div class="grid cols-2">
        <div>
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
          <input id="loginUser" placeholder="Ù…Ø«Ø§Ù„: employee" />
        </div>
        <div>
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input id="loginPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </div>
      </div>

      <div class="row" style="justify-content:space-between;margin-top:14px">
        <div class="row">
          <button class="btn primary" id="doLogin" type="button">Ø¯Ø®ÙˆÙ„</button>
          <button class="btn ghost" id="closeLogin" type="button">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div class="mini">
          Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§: Ù…ÙˆØ¸Ù employee/1234 â€¢ Ù…Ø¯ÙŠØ± admin/admin123
        </div>
      </div>
    </div>
  </div>

  <main class="container">
    <!-- Employee -->
    <section id="view-employee">
      <div class="hero">
        <div>
          <h1>ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h1>
          <p>
            Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø¹Ø¨Ù‘Ø¦ Ø§Ù„ØªÙØ§ØµÙŠÙ„ØŒ ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨ØªØªØ¨Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø­ØªÙ‰ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø².
            <strong>Ø·Ù„Ø¨ Ø£Ø¯Ø§Ø© AI</strong>ØŒ <strong>Ø·Ù„Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ù…ÙˆÙ„Ù‘Ø¯</strong>ØŒ Ø£Ùˆ <strong>Ø·Ù„Ø¨ ÙˆØ±Ø´Ø© Ø¹Ù…Ù„</strong>.
          </p>
        </div>
        <div class="row">
          <button class="btn ghost" id="btn-seed" type="button">Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
          <button class="btn danger" id="btn-reset" type="button">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
      </div>

      <div class="spacer"></div>

      <div class="grid cols-2">
        <div class="card">
          <h2>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨</h2>
          <div class="sub">Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙˆØ± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆÙŠÙ…ÙƒÙ† Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©.</div>

          <form id="request-form" autocomplete="off">
            <div class="grid cols-2">
              <div>
                <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                <input required id="empName" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯" />
              </div>
              <div>
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input required id="empEmail" type="email" placeholder="name@company.com" />
              </div>
            </div>

            <div class="grid cols-2">
              <div>
                <label>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© / Ø§Ù„Ù‚Ø³Ù…</label>
                <select required id="department">
                  <option value="" selected disabled>Ø§Ø®ØªØ±â€¦</option>
                  <option>ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                  <option>Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ</option>
                  <option>Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option>
                  <option>Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
                  <option>Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ</option>
                  <option>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</option>
                  <option>Ø£Ø®Ø±Ù‰</option>
                </select>
              </div>

              <div>
                <label>Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</label>
                <select required id="reqType">
                  <option value="" selected disabled>Ø§Ø®ØªØ±â€¦</option>
                  <option value="AI_TOOL">ğŸ”§ Ø·Ù„Ø¨ Ø£Ø¯Ø§Ø© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
                  <option value="AI_APP">ğŸ“± Ø·Ù„Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ù…ÙÙˆÙ„Ù‘ÙØ¯ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
                  <option value="AI_WORKSHOP">ğŸ“ Ø·Ù„Ø¨ ÙˆØ±Ø´Ø© Ø¹Ù…Ù„ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
                </select>
              </div>
            </div>

            <div class="grid cols-2">
              <div>
                <label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                <select required id="priority">
                  <option value="Ø¹Ø§Ø¯ÙŠØ©" selected>Ø¹Ø§Ø¯ÙŠØ©</option>
                  <option value="Ø¹Ø§Ù„ÙŠØ©">Ø¹Ø§Ù„ÙŠØ©</option>
                  <option value="Ø¹Ø§Ø¬Ù„Ø©">Ø¹Ø§Ø¬Ù„Ø©</option>
                </select>
              </div>
              <div>
                <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
                <input required id="dueDate" type="date" />
                <div class="hint">Ø³ÙŠÙØ¹ØªØ¨Ø± Ø§Ù„Ø·Ù„Ø¨ â€œÙ…ØªØ£Ø®Ø±â€ Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ² ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ ÙˆÙ„Ù… ÙŠÙƒØªÙ…Ù„.</div>
              </div>
            </div>

            <label>Ø¹Ù†ÙˆØ§Ù† Ù…Ø®ØªØµØ± Ù„Ù„Ø·Ù„Ø¨</label>
            <input required id="title" placeholder="Ù…Ø«Ø§Ù„: Ø£ØªÙ…ØªØ© ØªÙ„Ø®ÙŠØµ Ù…Ø­Ø§Ø¶Ø± Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª" />

            <label>ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ</label>
            <textarea required id="details" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŒ Ø§Ù„Ù‡Ø¯ÙØŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©ØŒ Ù…Ø®Ø±Ø¬Ø§Øª Ù…ØªÙˆÙ‚Ø¹Ø©â€¦"></textarea>

            <div class="row" style="justify-content:space-between;margin-top:14px">
              <div class="row">
                <button class="btn primary" type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                <button class="btn ghost" id="btn-clear-form" type="button">ØªÙØ±ÙŠØº Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
              </div>
              <span class="pill" id="pill-count">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: 0</span>
            </div>
          </form>
        </div>

        <div class="card">
          <h2>Ø¢Ø®Ø± 5 Ø·Ù„Ø¨Ø§Øª</h2>
          <div id="recent" class="barlist"></div>
        </div>
      </div>
    </section>

    <!-- Admin -->
    <section id="view-admin" style="display:none">
      <div class="hero">
        <div>
          <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h1>
          <p>Ø¥Ø­ØµØ§Ø¡Ø§Øª ÙÙˆØ±ÙŠØ©ØŒ ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª ÙˆØ£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø´Ø§Ù…Ù„Ø© Ù…Ø¹ ÙÙ„Ø§ØªØ± ÙˆØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø¨.</p>
        </div>
        <div class="row">
          <button class="btn ghost" id="btn-export" type="button">ØªØµØ¯ÙŠØ± JSON</button>
          <button class="btn ghost" id="btn-import" type="button">Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON</button>
          <input id="importFile" type="file" accept="application/json" style="display:none" />
        </div>
      </div>

      <div class="spacer"></div>

      <div class="grid cols-4">
        <div class="stat"><div><div class="k">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div><div class="v" id="s-total">0</div></div><div class="tag">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</div></div>
        <div class="stat"><div><div class="k">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div><div class="v" id="s-inprogress">0</div></div><div class="tag warn">In-Process</div></div>
        <div class="stat"><div><div class="k">Ù…ÙƒØªÙ…Ù„Ø©</div><div class="v" id="s-done">0</div></div><div class="tag ok">Completed</div></div>
        <div class="stat"><div><div class="k">Ù…ØªØ£Ø®Ø±Ø©</div><div class="v" id="s-late">0</div></div><div class="tag bad">Late</div></div>
      </div>

      <div class="spacer"></div>

      <div class="grid cols-2">
        <div class="card">
          <h2>Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
          <div class="sub">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</div>
          <div id="byDept" class="barlist"></div>
        </div>

        <div class="card">
          <h2>Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</h2>
          <div class="sub">ğŸ”§ Ø£Ø¯Ø§Ø© | ğŸ“± ØªØ·Ø¨ÙŠÙ‚ | ğŸ“ ÙˆØ±Ø´Ø©</div>
          <div id="byType" class="barlist"></div>
        </div>
      </div>

      <div class="spacer"></div>

      <div class="card">
        <div class="row" style="justify-content:space-between; align-items:flex-end">
          <div>
            <h2 style="margin-bottom:4px">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
            <div class="sub">ÙÙ„ØªØ±Ø©ØŒ Ø¹Ø±Ø¶ØŒ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©/Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚/Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</div>
          </div>

          <div class="right">
            <div style="min-width:220px">
              <label style="margin:0 0 6px">Ø¨Ø­Ø«</label>
              <input id="q" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†/Ø§Ù„ÙˆØµÙ/Ø§Ù„Ø§Ø³Ù…â€¦" />
            </div>

            <div style="min-width:180px">
              <label style="margin:0 0 6px">Ø§Ù„Ø­Ø§Ù„Ø©</label>
              <select id="fStatus">
                <option value="ALL" selected>Ø§Ù„ÙƒÙ„</option>
                <option value="NEW">Ø¬Ø¯ÙŠØ¯</option>
                <option value="IN_PROGRESS">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                <option value="DONE">Ù…ÙƒØªÙ…Ù„</option>
                <option value="LATE">Ù…ØªØ£Ø®Ø±</option>
              </select>
            </div>

            <div style="min-width:200px">
              <label style="margin:0 0 6px">Ø§Ù„Ù†ÙˆØ¹</label>
              <select id="fType">
                <option value="ALL" selected>Ø§Ù„ÙƒÙ„</option>
                <option value="AI_TOOL">ğŸ”§ Ø£Ø¯Ø§Ø© AI</option>
                <option value="AI_APP">ğŸ“± ØªØ·Ø¨ÙŠÙ‚ AI</option>
                <option value="AI_WORKSHOP">ğŸ“ ÙˆØ±Ø´Ø©</option>
              </select>
            </div>

            <div style="min-width:200px">
              <label style="margin:0 0 6px">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</label>
              <select id="fDept">
                <option value="ALL" selected>Ø§Ù„ÙƒÙ„</option>
              </select>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Ø§Ù„Ù…Ø¹Ø±Ù‘Ù</th><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†/Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th><th>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
      </div>
    </section>

    <div class="footer">Â© Ù†Ù…ÙˆØ°Ø¬ ØªØ¬Ø±ÙŠØ¨ÙŠ ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§ (LocalStorage). ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‡Ù†Ø§ â€œØ¨Ø³ÙŠØ·â€ Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·.</div>
  </main>

  <div class="toast" id="toast">ØªÙ….</div>

  <script>
    // -----------------------------
    // SIMPLE LOGIN (front-end only)
    // -----------------------------
    const SESSION_KEY = "AI_RMS_SESSION_V1";
    // ØºÙŠÙ‘Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‡Ù†Ø§:
    const CREDS = {
      EMPLOYEE: { user: "employee", pass: "1234" },
      ADMIN:    { user: "admin",    pass: "admin123" }
    };

    const loginOverlay = document.getElementById("loginOverlay");
    const btnLogin = document.getElementById("btn-login");
    const btnLogout = document.getElementById("btn-logout");
    const sessionPill = document.getElementById("sessionPill");

    const loginRole = document.getElementById("loginRole");
    const loginUser = document.getElementById("loginUser");
    const loginPass = document.getElementById("loginPass");
    const doLogin = document.getElementById("doLogin");
    const closeLogin = document.getElementById("closeLogin");

    function getSession(){
      try { return JSON.parse(localStorage.getItem(SESSION_KEY) || "null"); } catch { return null; }
    }
    function setSession(s){
      localStorage.setItem(SESSION_KEY, JSON.stringify(s));
      applyAuth();
    }
    function clearSession(){
      localStorage.removeItem(SESSION_KEY);
      applyAuth();
    }
    function openLogin(){
      loginOverlay.style.display = "flex";
      loginOverlay.setAttribute("aria-hidden","false");
      const s = getSession();
      sessionPill.textContent = s ? (s.role === "ADMIN" ? "Ù…Ø¯ÙŠØ±" : "Ù…ÙˆØ¸Ù") : "ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„";
      if(!loginUser.value) loginUser.value = (loginRole.value === "ADMIN") ? CREDS.ADMIN.user : CREDS.EMPLOYEE.user;
      loginPass.focus();
    }
    function closeLoginModal(){
      loginOverlay.style.display = "none";
      loginOverlay.setAttribute("aria-hidden","true");
    }

    btnLogin.addEventListener("click", openLogin);
    closeLogin.addEventListener("click", closeLoginModal);
    loginOverlay.addEventListener("click", (e)=>{ if(e.target === loginOverlay) closeLoginModal(); });

    loginRole.addEventListener("change", () => {
      loginUser.value = (loginRole.value === "ADMIN") ? CREDS.ADMIN.user : CREDS.EMPLOYEE.user;
      loginPass.value = "";
      loginPass.focus();
    });

    doLogin.addEventListener("click", () => {
      const role = loginRole.value;
      const u = (loginUser.value||"").trim();
      const p = (loginPass.value||"").trim();
      const ok = (u === CREDS[role].user && p === CREDS[role].pass);
      if(!ok){ toast("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©."); return; }
      setSession({ role, user: u, at: new Date().toISOString() });
      toast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
      closeLoginModal();
      if(role === "ADMIN") setView("ADM"); else setView("EMP");
    });

    btnLogout.addEventListener("click", () => {
      clearSession();
      toast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.");
      setView("EMP");
    });

    // -----------------------------
    // App storage + helpers
    // -----------------------------
    const KEY = "AI_REQUESTS_V1";
    const now = () => new Date();
    const isoDate = (d) => d.toISOString().slice(0,10);
    const fmtDate = (s) => {
      if(!s) return "â€”";
      const d = new Date(s + "T00:00:00");
      return d.toLocaleDateString("ar-SA", {year:"numeric", month:"2-digit", day:"2-digit"});
    };
    const uid = () => "REQ-" + Date.now().toString().slice(-6) + "-" + Math.random().toString(16).slice(2,7).toUpperCase();
    const load = () => { try { return JSON.parse(localStorage.getItem(KEY) || "[]"); } catch { return []; } };
    const save = (arr) => localStorage.setItem(KEY, JSON.stringify(arr));
    const toast = (msg) => { const t=document.getElementById("toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),2200); };

    const typeLabel = (t) => ({AI_TOOL:"ğŸ”§ Ø£Ø¯Ø§Ø© AI", AI_APP:"ğŸ“± ØªØ·Ø¨ÙŠÙ‚ AI", AI_WORKSHOP:"ğŸ“ ÙˆØ±Ø´Ø©"}[t]||t);
    const statusLabel = (s) => ({NEW:"Ø¬Ø¯ÙŠØ¯", IN_PROGRESS:"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©", DONE:"Ù…ÙƒØªÙ…Ù„", LATE:"Ù…ØªØ£Ø®Ø±"}[s]||s);
    const statusBadgeClass = (s)=>({NEW:"new",IN_PROGRESS:"inprogress",DONE:"done",LATE:"late"}[s]||"new");
    const computeLate = (req)=>{ if(req.status==="DONE"||!req.dueDate) return false; return now() > new Date(req.dueDate+"T23:59:59"); };
    const normalizeStatuses = (requests)=>requests.map(r=>{
      const late=computeLate(r);
      if(late && r.status!=="LATE") return {...r,status:"LATE"};
      if(!late && r.status==="LATE") return {...r,status:"IN_PROGRESS"};
      return r;
    });

    // -----------------------------
    // Initial UI setup
    // -----------------------------
    document.getElementById("pill-now").textContent = "Ø§Ù„ÙŠÙˆÙ…: " + fmtDate(isoDate(now()));
    const d0 = new Date(); d0.setDate(d0.getDate()+14);
    document.getElementById("dueDate").value = isoDate(d0);

    // Tabs & views
    const tabEmp=document.getElementById("tab-employee");
    const tabAdm=document.getElementById("tab-admin");
    const viewEmp=document.getElementById("view-employee");
    const viewAdm=document.getElementById("view-admin");

    function setView(which){
      const emp = which==="EMP";
      tabEmp.classList.toggle("active", emp);
      tabAdm.classList.toggle("active", !emp);
      viewEmp.style.display = emp ? "" : "none";
      viewAdm.style.display = emp ? "none" : "";
      renderAll();
    }

    tabEmp.addEventListener("click", ()=>setView("EMP"));
    tabAdm.addEventListener("click", ()=>{
      const s = getSession();
      if(!s || s.role !== "ADMIN"){
        toast("Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·. Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ±.");
        openLogin();
        return;
      }
      setView("ADM");
    });

    // Seed + reset
    document.getElementById("btn-reset").addEventListener("click", () => {
      if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŸ")){
        save([]); toast("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª."); renderAll();
      }
    });

    document.getElementById("btn-seed").addEventListener("click", () => {
      const base=load();
      const seeded=base.concat([
        {id:uid(),empName:"Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯",empEmail:"sara@example.com",department:"Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ",reqType:"AI_WORKSHOP",priority:"Ø¹Ø§Ø¯ÙŠØ©",
         title:"ÙˆØ±Ø´Ø© Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ÙŠ",details:"ÙˆØ±Ø´Ø© 3 Ø³Ø§Ø¹Ø§Øª Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† ØºÙŠØ± Ø§Ù„ØªÙ‚Ù†ÙŠÙŠÙ† Ù…Ø¹ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ©.",
         createdAt:new Date(Date.now()-86400000*6).toISOString(),dueDate:isoDate(new Date(Date.now()+86400000*10)),status:"IN_PROGRESS",adminNotes:"ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§ÙˆØ± ÙˆØ§Ù„Ù…Ø¯Ø±Ø¨."},
        {id:uid(),empName:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø§Ù„Ù…",empEmail:"abdullah@example.com",department:"ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",reqType:"AI_TOOL",priority:"Ø¹Ø§Ù„ÙŠØ©",
         title:"Ø£Ø¯Ø§Ø© ØªØµÙ†ÙŠÙ Ø§Ù„ØªØ°Ø§ÙƒØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹",details:"ØªØµÙ†ÙŠÙ ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù‚ØªØ±Ø§Ø­ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ù…Ø¹ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©.",
         createdAt:new Date(Date.now()-86400000*12).toISOString(),dueDate:isoDate(new Date(Date.now()-86400000*1)),status:"IN_PROGRESS",adminNotes:"Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª."},
        {id:uid(),empName:"Ø±ÙŠÙ… Ø®Ø§Ù„Ø¯",empEmail:"reem@example.com",department:"Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©",reqType:"AI_APP",priority:"Ø¹Ø§Ø¯ÙŠØ©",
         title:"ØªØ·Ø¨ÙŠÙ‚ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª (ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø³ÙŠØ·Ø©)",details:"ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø¬Ø§Ø²Ø© + Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø¯ÙŠØ± + Ø¥Ø´Ø¹Ø§Ø±Ø§Øª. ØªÙƒØ§Ù…Ù„ Ù„Ø§Ø­Ù‚Ø§Ù‹.",
         createdAt:new Date(Date.now()-86400000*2).toISOString(),dueDate:isoDate(new Date(Date.now()+86400000*21)),status:"NEW",adminNotes:"â€”"}
      ]);
      save(seeded); toast("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©."); renderAll();
    });

    document.getElementById("btn-clear-form").addEventListener("click", ()=>{
      document.getElementById("request-form").reset();
      document.getElementById("dueDate").value = isoDate(d0);
    });

    // Form submit: ÙŠØ­ØªØ§Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
    document.getElementById("request-form").addEventListener("submit", (e)=>{
      e.preventDefault();
      const s = getSession();
      if(!s){ toast("ÙØ¶Ù„Ø§Ù‹ Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹."); openLogin(); return; }

      const req={
        id:uid(),
        empName:document.getElementById("empName").value.trim(),
        empEmail:document.getElementById("empEmail").value.trim(),
        department:document.getElementById("department").value,
        reqType:document.getElementById("reqType").value,
        priority:document.getElementById("priority").value,
        title:document.getElementById("title").value.trim(),
        details:document.getElementById("details").value.trim(),
        createdAt:new Date().toISOString(),
        dueDate:document.getElementById("dueDate").value,
        status:"NEW",
        adminNotes:"",
        submittedBy: s.user
      };
      const all=load(); all.unshift(req); save(all);
      toast("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
      document.getElementById("request-form").reset();
      document.getElementById("dueDate").value=isoDate(d0);
      renderAll();
    });

    // Export/Import (Admin only)
    document.getElementById("btn-export").addEventListener("click", ()=>{
      const s=getSession();
      if(!s || s.role!=="ADMIN"){ toast("Ø§Ù„ØªØµØ¯ÙŠØ± Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·."); openLogin(); return; }
      const data=load();
      const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
      const a=document.createElement("a");
      a.href=URL.createObjectURL(blob); a.download="ai-requests.json"; a.click();
      URL.revokeObjectURL(a.href);
    });

    document.getElementById("btn-import").addEventListener("click", ()=>{
      const s=getSession();
      if(!s || s.role!=="ADMIN"){ toast("Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·."); openLogin(); return; }
      document.getElementById("importFile").click();
    });

    document.getElementById("importFile").addEventListener("change", async (e)=>{
      const s=getSession();
      if(!s || s.role!=="ADMIN"){ toast("Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·."); openLogin(); e.target.value=""; return; }
      const file=e.target.files?.[0]; if(!file) return;
      try{
        const text=await file.text();
        const arr=JSON.parse(text);
        if(!Array.isArray(arr)) throw new Error("JSON ØºÙŠØ± ØµØ­ÙŠØ­");
        save(arr); toast("ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­."); renderAll();
      }catch(err){ alert("ØªØ¹Ø°Ø± Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: "+err.message); }
      finally{ e.target.value=""; }
    });

    // Filters
    const q=document.getElementById("q");
    const fStatus=document.getElementById("fStatus");
    const fType=document.getElementById("fType");
    const fDept=document.getElementById("fDept");
    [q,fStatus,fType,fDept].forEach(el=>el.addEventListener("input", renderAll));

    // -----------------------------
    // Rendering
    // -----------------------------
    function renderAll(){
      const raw=load();
      const requests=normalizeStatuses(raw);
      if(JSON.stringify(raw)!==JSON.stringify(requests)) save(requests);

      document.getElementById("pill-count").textContent="Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: "+requests.length;
      renderRecent(requests);

      renderStats(requests);
      renderBreakdowns(requests);
      renderDeptFilterOptions(requests);
      renderTable(requests);

      applyAuth();
    }

    function renderRecent(requests){
      const wrap=document.getElementById("recent");
      wrap.innerHTML="";
      const last=requests.slice(0,5);
      if(last.length===0){ wrap.innerHTML=`<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯.</div>`; return; }
      last.forEach(r=>{
        const el=document.createElement("div");
        el.className="card"; el.style.boxShadow="none"; el.style.borderRadius="14px"; el.style.padding="12px";
        el.innerHTML=`
          <div class="row" style="justify-content:space-between">
            <div style="font-weight:900">${escapeHtml(r.title)}</div>
            <span class="badge ${statusBadgeClass(r.status)}">${statusLabel(r.status)}</span>
          </div>
          <div class="muted" style="margin-top:6px;font-size:13px">
            ${typeLabel(r.reqType)} â€¢ ${escapeHtml(r.department)} â€¢ Ø§Ø³ØªØ­Ù‚Ø§Ù‚: ${fmtDate(r.dueDate)}
          </div>
          <div class="muted mono" style="margin-top:6px">${r.id}</div>
        `;
        wrap.appendChild(el);
      });
    }

    function renderStats(requests){
      document.getElementById("s-total").textContent=requests.length;
      document.getElementById("s-inprogress").textContent=requests.filter(r=>r.status==="IN_PROGRESS").length;
      document.getElementById("s-done").textContent=requests.filter(r=>r.status==="DONE").length;
      document.getElementById("s-late").textContent=requests.filter(r=>r.status==="LATE").length;
    }

    function pct(n,d){return d?Math.round((n/d)*100):0}

    function renderBreakdowns(requests){
      const deptCounts={};
      const typeCounts={AI_TOOL:0,AI_APP:0,AI_WORKSHOP:0};
      requests.forEach(r=>{
        deptCounts[r.department]=(deptCounts[r.department]||0)+1;
        typeCounts[r.reqType]=(typeCounts[r.reqType]||0)+1;
      });

      const total=requests.length;

      const byDept=document.getElementById("byDept");
      byDept.innerHTML="";
      const sortedDepts=Object.entries(deptCounts).sort((a,b)=>b[1]-a[1]);
      if(sortedDepts.length===0){ byDept.innerHTML=`<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.</div>`; }
      else sortedDepts.forEach(([name,count])=>byDept.appendChild(makeBar(name,count,pct(count,total))));

      const byType=document.getElementById("byType");
      byType.innerHTML="";
      const types=[["ğŸ”§ Ø£Ø¯Ø§Ø© AI",typeCounts.AI_TOOL],["ğŸ“± ØªØ·Ø¨ÙŠÙ‚ AI",typeCounts.AI_APP],["ğŸ“ ÙˆØ±Ø´Ø©",typeCounts.AI_WORKSHOP]];
      if(total===0){ byType.innerHTML=`<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.</div>`; }
      else types.forEach(([name,count])=>byType.appendChild(makeBar(name,count,pct(count,total))));
    }

    function makeBar(name,count,percent){
      const row=document.createElement("div");
      row.className="bar";
      row.innerHTML=`
        <div class="name">${escapeHtml(name)}</div>
        <div class="track"><div class="fill" style="width:${percent}%"></div></div>
        <div class="pct">${count} (${percent}%)</div>
      `;
      return row;
    }

    function renderDeptFilterOptions(requests){
      const values=[...new Set(requests.map(r=>r.department))].sort();
      const current=fDept.value||"ALL";
      fDept.innerHTML=`<option value="ALL">Ø§Ù„ÙƒÙ„</option>` + values.map(v=>`<option>${escapeHtml(v)}</option>`).join("");
      fDept.value = values.includes(current) ? current : "ALL";
    }

    function renderTable(requests){
      const tbody=document.getElementById("rows");
      tbody.innerHTML="";
      const qs=(q.value||"").trim().toLowerCase();
      const st=fStatus.value, tp=fType.value, dp=fDept.value;

      const filtered=requests.filter(r=>{
        const effectiveStatus=computeLate(r)?"LATE":r.status;
        if(st!=="ALL" && effectiveStatus!==st) return false;
        if(tp!=="ALL" && r.reqType!==tp) return false;
        if(dp!=="ALL" && r.department!==dp) return false;
        if(qs){
          const hay=(r.title+" "+r.details+" "+r.empName+" "+r.empEmail+" "+r.id).toLowerCase();
          if(!hay.includes(qs)) return false;
        }
        return true;
      });

      if(filtered.length===0){
        const tr=document.createElement("tr");
        tr.innerHTML=`<td colspan="10" class="muted" style="padding:18px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</td>`;
        tbody.appendChild(tr); return;
      }

      filtered.forEach(r=>{
        const effectiveStatus=computeLate(r)?"LATE":r.status;
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td class="mono">${r.id}</td>
          <td><div style="font-weight:900">${escapeHtml(r.empName)}</div><div class="muted" style="font-size:12.5px">${escapeHtml(r.empEmail)}</div></td>
          <td>${escapeHtml(r.department)}</td>
          <td>${typeLabel(r.reqType)}</td>
          <td><span class="badge">${escapeHtml(r.priority)}</span></td>
          <td>
            <div style="font-weight:900">${escapeHtml(r.title)}</div>
            <div class="muted" style="margin-top:6px;max-width:520px">${escapeHtml(r.details).slice(0,160)}${r.details.length>160?"â€¦":""}</div>
            ${r.adminNotes ? `<div class="muted" style="margin-top:8px"><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${escapeHtml(r.adminNotes)}</div>` : ``}
            ${r.submittedBy ? `<div class="muted" style="margin-top:8px"><strong>Ø£ÙØ±Ø³Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©:</strong> ${escapeHtml(r.submittedBy)}</div>` : ``}
          </td>
          <td>${fmtDate(r.createdAt.slice(0,10))}</td>
          <td>${fmtDate(r.dueDate)}</td>
          <td><span class="badge ${statusBadgeClass(effectiveStatus)}">${statusLabel(effectiveStatus)}</span></td>
          <td>
            <div class="row" style="gap:8px">
              <select data-action="status" data-id="${r.id}" class="smallSelect">
                <option value="NEW" ${r.status==="NEW"?"selected":""}>Ø¬Ø¯ÙŠØ¯</option>
                <option value="IN_PROGRESS" ${r.status==="IN_PROGRESS"?"selected":""}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                <option value="DONE" ${r.status==="DONE"?"selected":""}>Ù…ÙƒØªÙ…Ù„</option>
              </select>
              <input data-action="due" data-id="${r.id}" type="date" value="${escapeAttr(r.dueDate||"")}" style="width:160px" />
              <input data-action="notes" data-id="${r.id}" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©â€¦" value="${escapeAttr(r.adminNotes||"")}" style="width:220px" />
              <button class="btn small danger" data-action="delete" data-id="${r.id}" type="button">Ø­Ø°Ù</button>
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      });

      tbody.querySelectorAll("[data-action]").forEach(el=>{
        el.addEventListener("change", onAdminEdit);
        el.addEventListener("input", onAdminEdit);
        el.addEventListener("click", onAdminEdit);
      });

      tbody.querySelectorAll(".smallSelect").forEach(s=>{
        s.style.padding="8px 10px"; s.style.borderRadius="10px";
        s.style.border="1px solid var(--stroke)"; s.style.fontFamily="inherit";
        s.style.fontWeight="900"; s.style.background="#fff";
      });
    }

    function onAdminEdit(e){
      const s=getSession();
      if(!s || s.role!=="ADMIN"){ toast("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·."); openLogin(); return; }

      const action=e.target.getAttribute("data-action");
      const id=e.target.getAttribute("data-id");
      if(!action||!id) return;

      const all=load();
      const idx=all.findIndex(x=>x.id===id);
      if(idx<0) return;

      if(action==="delete"){
        if(confirm("Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ")){
          all.splice(idx,1); save(all); toast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨."); renderAll();
        }
        return;
      }

      if(action==="status") all[idx].status=e.target.value;
      if(action==="due") all[idx].dueDate=e.target.value;
      if(action==="notes") all[idx].adminNotes=e.target.value;

      save(all); renderAll();
    }

    function escapeHtml(s){
      return String(s||"").replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;", "\"":"&quot;","'":"&#039;" }[m]));
    }
    function escapeAttr(s){ return String(s||"").replace(/"/g, "&quot;"); }

    function applyAuth(){
      const s=getSession();
      btnLogin.style.display = s ? "none" : "";
      btnLogout.style.display = s ? "" : "none";

      const isAdmin = s && s.role === "ADMIN";
      tabAdm.disabled = !isAdmin;
      tabAdm.style.opacity = isAdmin ? "1" : ".6";
    }

    // First render + auth
    renderAll();
    applyAuth();
  </script>
</body>
</html>
